<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
        <html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
          <head>
            <title>mochiweb_util - C0 code coverage information</title>
            <style type='text/css'>body { background-color: rgb(240, 240, 245); }</style>
            <style type='text/css'>span.marked0 {
     background-color: rgb(185, 210, 200);
     display: block;
    }
    span.marked { display: block; background-color: #ffffff; }
    span.highlight { display: block; background-color: #fff9d7; }
    span.covered { display: block; background-color: #f7f7f7 ; }
    span.uncovered { display: block; background-color: #ffebe8 ; }
    span.overview {
     border-bottom: 1px solid #E2E6EF; 
    }
    div.overview {
     border-bottom: 1px solid #E2E6EF; 
    }
    body {
     font-family: verdana, arial, helvetica;
    }
    div.footer {
     font-size: 68%;
     margin-top: 1.5em;
    }
    h1, h2, h3, h4, h5, h6 {
     margin-bottom: 0.5em;
    }
    h5 {
     margin-top: 0.5em;
    }
    .hidden {
     display: none;
    }
    div.separator {
     height: 10px;
    }
    table.percent_graph {
     height: 12px;
     border: 1px solid #E2E6EF; 
     empty-cells: show;
    }
    table.percent_graph td.covered {
     height: 10px;
     background: #00f000;
    }
    table.percent_graph td.uncovered {
     height: 10px;
     background: #e00000;
    }
    table.percent_graph td.NA {
     height: 10px;
     background: #eaeaea;
    }
    table.report {
     border-collapse: collapse;
     width: 100%;
    }
    table.report td.heading {
     background: #dcecff;
     border: 1px solid #E2E6EF; 
     font-weight: bold;
     text-align: center;
    }
    table.report td.heading:hover {
     background: #c0ffc0;
    }
    table.report td.text {
     border: 1px solid #E2E6EF; 
    }
    table.report td.value {
     text-align: right;
     border: 1px solid #E2E6EF; 
    }
    table.report tr.light {
     background-color: rgb(240, 240, 245);
    }
    table.report tr.dark {
     background-color: rgb(230, 230, 235);
    }
    </style>
          </head>
          <body>
            <h3>C0 code coverage information</h3>
            <p>Generated on 2009-02-25 00:22:45 with <a href='http://github.com/ngerakines/etap'>etap 0.3.3</a>.
            </p>            
        <table class='report'>
          <thead>
            <tr>
              <td class='heading'>Name</td>
              <td class='heading'>Total lines</td>
              <td class='heading'>Lines of code</td>
              <td class='heading'>Total coverage</td>
              <td class='heading'>Code coverage</td>
            </tr>
          </thead>
          <tbody>
            <tr class='light'>

              <td>
                <a href='mochiweb_util_report.html'>mochiweb_util</a>
              </td>
              <td class='value'>
                <tt>??</tt>
              </td>
              <td class='value'>
                <tt>??</tt>
              </td>
              <td class='value'>
                <tt>??</tt>
              </td>
              <td>
                <table cellspacing='0' cellpadding='0' align='right'>
                  <tr>
                    <td><tt>1%</tt>&nbsp;</td><td>
                      <table cellspacing='0' class='percent_graph' cellpadding='0' width='100'>
                      <tr><td class='covered' width='1' /><td class='uncovered' width='99' /></tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </tbody>
        </table><pre><span class="marked"><a name="line1"></a>....1 %% @author Bob Ippolito <bob@mochimedia.com>
</span><span class="marked"><a name="line2"></a>....2 %% @copyright 2007 Mochi Media, Inc.
</span><span class="marked"><a name="line3"></a>....3 
</span><span class="marked"><a name="line4"></a>....4 %% @doc Utilities for parsing and quoting.
</span><span class="marked"><a name="line5"></a>....5 
</span><span class="marked"><a name="line6"></a>....6 -module(mochiweb_util).
</span><span class="marked"><a name="line7"></a>....7 -author('bob@mochimedia.com').
</span><span class="marked"><a name="line8"></a>....8 -export([join/2, quote_plus/1, urlencode/1, parse_qs/1, unquote/1]).
</span><span class="marked"><a name="line9"></a>....9 -export([path_split/1]).
</span><span class="marked"><a name="line10"></a>...10 -export([urlsplit/1, urlsplit_path/1, urlunsplit/1, urlunsplit_path/1]).
</span><span class="marked"><a name="line11"></a>...11 -export([guess_mime/1, parse_header/1]).
</span><span class="marked"><a name="line12"></a>...12 -export([shell_quote/1, cmd/1, cmd_string/1, cmd_port/2]).
</span><span class="marked"><a name="line13"></a>...13 -export([record_to_proplist/2, record_to_proplist/3]).
</span><span class="marked"><a name="line14"></a>...14 -export([safe_relative_path/1, partition/2]).
</span><span class="marked"><a name="line15"></a>...15 -export([is_atleast_version/1]).
</span><span class="marked"><a name="line16"></a>...16 -export([test/0]).
</span><span class="marked"><a name="line17"></a>...17 
</span><span class="marked"><a name="line18"></a>...18 -define(PERCENT, 37).  % $\%
</span><span class="marked"><a name="line19"></a>...19 -define(FULLSTOP, 46). % $\.
</span><span class="marked"><a name="line20"></a>...20 -define(IS_HEX(C), ((C >= $0 andalso C =< $9) orelse
</span><span class="marked"><a name="line21"></a>...21                     (C >= $a andalso C =< $f) orelse
</span><span class="marked"><a name="line22"></a>...22                     (C >= $A andalso C =< $F))).
</span><span class="marked"><a name="line23"></a>...23 -define(QS_SAFE(C), ((C >= $a andalso C =< $z) orelse
</span><span class="marked"><a name="line24"></a>...24                      (C >= $A andalso C =< $Z) orelse
</span><span class="marked"><a name="line25"></a>...25                      (C >= $0 andalso C =< $9) orelse
</span><span class="marked"><a name="line26"></a>...26                      (C =:= ?FULLSTOP orelse C =:= $- orelse C =:= $~ orelse
</span><span class="marked"><a name="line27"></a>...27                       C =:= $_))).
</span><span class="marked"><a name="line28"></a>...28 
</span><span class="uncovered"><a name="line29"></a>...29 hexdigit(C) when C < 10 -> $0 + C;
</span><span class="uncovered"><a name="line30"></a>...30 hexdigit(C) when C < 16 -> $A + (C - 10).
</span><span class="marked"><a name="line31"></a>...31 
</span><span class="uncovered"><a name="line32"></a>...32 unhexdigit(C) when C >= $0, C =< $9 -> C - $0;
</span><span class="uncovered"><a name="line33"></a>...33 unhexdigit(C) when C >= $a, C =< $f -> C - $a + 10;
</span><span class="uncovered"><a name="line34"></a>...34 unhexdigit(C) when C >= $A, C =< $F -> C - $A + 10.
</span><span class="marked"><a name="line35"></a>...35 
</span><span class="marked"><a name="line36"></a>...36 %% @spec partition(String, Sep) -> {String, [], []} | {Prefix, Sep, Postfix}
</span><span class="marked"><a name="line37"></a>...37 %% @doc Inspired by Python 2.5's str.partition:
</span><span class="marked"><a name="line38"></a>...38 %%      partition("foo/bar", "/") = {"foo", "/", "bar"},
</span><span class="marked"><a name="line39"></a>...39 %%      partition("foo", "/") = {"foo", "", ""}.
</span><span class="marked"><a name="line40"></a>...40 partition(String, Sep) ->
</span><span class="uncovered"><a name="line41"></a>...41     case partition(String, Sep, []) of
</span><span class="marked"><a name="line42"></a>...42         undefined ->
</span><span class="uncovered"><a name="line43"></a>...43             {String, "", ""};
</span><span class="marked"><a name="line44"></a>...44         Result ->
</span><span class="uncovered"><a name="line45"></a>...45             Result
</span><span class="marked"><a name="line46"></a>...46     end.
</span><span class="marked"><a name="line47"></a>...47 
</span><span class="marked"><a name="line48"></a>...48 partition("", _Sep, _Acc) ->
</span><span class="uncovered"><a name="line49"></a>...49     undefined;
</span><span class="marked"><a name="line50"></a>...50 partition(S, Sep, Acc) ->
</span><span class="uncovered"><a name="line51"></a>...51     case partition2(S, Sep) of
</span><span class="marked"><a name="line52"></a>...52         undefined ->
</span><span class="uncovered"><a name="line53"></a>...53             [C | Rest] = S,
</span><span class="uncovered"><a name="line54"></a>...54             partition(Rest, Sep, [C | Acc]);
</span><span class="marked"><a name="line55"></a>...55         Rest ->
</span><span class="uncovered"><a name="line56"></a>...56             {lists:reverse(Acc), Sep, Rest}
</span><span class="marked"><a name="line57"></a>...57     end.
</span><span class="marked"><a name="line58"></a>...58 
</span><span class="marked"><a name="line59"></a>...59 partition2(Rest, "") ->
</span><span class="uncovered"><a name="line60"></a>...60     Rest;
</span><span class="marked"><a name="line61"></a>...61 partition2([C | R1], [C | R2]) ->
</span><span class="uncovered"><a name="line62"></a>...62     partition2(R1, R2);
</span><span class="marked"><a name="line63"></a>...63 partition2(_S, _Sep) ->
</span><span class="uncovered"><a name="line64"></a>...64     undefined.
</span><span class="marked"><a name="line65"></a>...65 
</span><span class="marked"><a name="line66"></a>...66 
</span><span class="marked"><a name="line67"></a>...67 
</span><span class="marked"><a name="line68"></a>...68 %% @spec safe_relative_path(string()) -> string() | undefined
</span><span class="marked"><a name="line69"></a>...69 %% @doc Return the reduced version of a relative path or undefined if it
</span><span class="marked"><a name="line70"></a>...70 %%      is not safe. safe relative paths can be joined with an absolute path
</span><span class="marked"><a name="line71"></a>...71 %%      and will result in a subdirectory of the absolute path.
</span><span class="marked"><a name="line72"></a>...72 safe_relative_path("/" ++ _) ->
</span><span class="uncovered"><a name="line73"></a>...73     undefined;
</span><span class="marked"><a name="line74"></a>...74 safe_relative_path(P) ->
</span><span class="uncovered"><a name="line75"></a>...75     safe_relative_path(P, []).
</span><span class="marked"><a name="line76"></a>...76 
</span><span class="marked"><a name="line77"></a>...77 safe_relative_path("", Acc) ->
</span><span class="uncovered"><a name="line78"></a>...78     case Acc of
</span><span class="marked"><a name="line79"></a>...79         [] ->
</span><span class="uncovered"><a name="line80"></a>...80             "";
</span><span class="marked"><a name="line81"></a>...81         _ ->
</span><span class="uncovered"><a name="line82"></a>...82           PathList = lists:reverse(Acc),
</span><span class="uncovered"><a name="line83"></a>...83           case is_atleast_version({5,6}) of
</span><span class="uncovered"><a name="line84"></a>...84             true -> string:join(PathList, "/");
</span><span class="uncovered"><a name="line85"></a>...85             false -> hd(PathList) ++ lists:concat(["/" ++ X || X <- tl(PathList)])
</span><span class="marked"><a name="line86"></a>...86           end
</span><span class="marked"><a name="line87"></a>...87     end;
</span><span class="marked"><a name="line88"></a>...88 safe_relative_path(P, Acc) ->
</span><span class="uncovered"><a name="line89"></a>...89     case partition(P, "/") of
</span><span class="marked"><a name="line90"></a>...90         {"", "/", _} ->
</span><span class="marked"><a name="line91"></a>...91             %% /foo or foo//bar
</span><span class="uncovered"><a name="line92"></a>...92             undefined;
</span><span class="marked"><a name="line93"></a>...93         {"..", _, _} when Acc =:= [] ->
</span><span class="uncovered"><a name="line94"></a>...94             undefined;
</span><span class="marked"><a name="line95"></a>...95         {"..", _, Rest} ->
</span><span class="uncovered"><a name="line96"></a>...96             safe_relative_path(Rest, tl(Acc));
</span><span class="marked"><a name="line97"></a>...97         {Part, "/", ""} ->
</span><span class="uncovered"><a name="line98"></a>...98             safe_relative_path("", ["", Part | Acc]);
</span><span class="marked"><a name="line99"></a>...99         {Part, _, Rest} ->
</span><span class="uncovered"><a name="line100"></a>..100             safe_relative_path(Rest, [Part | Acc])
</span><span class="marked"><a name="line101"></a>..101     end.
</span><span class="marked"><a name="line102"></a>..102 
</span><span class="marked"><a name="line103"></a>..103 %% @spec shell_quote(string()) -> string()
</span><span class="marked"><a name="line104"></a>..104 %% @doc Quote a string according to UNIX shell quoting rules, returns a string
</span><span class="marked"><a name="line105"></a>..105 %%      surrounded by double quotes.
</span><span class="marked"><a name="line106"></a>..106 shell_quote(L) ->
</span><span class="uncovered"><a name="line107"></a>..107     shell_quote(L, [$\"]).
</span><span class="marked"><a name="line108"></a>..108 
</span><span class="marked"><a name="line109"></a>..109 %% @spec cmd_port([string()], Options) -> port()
</span><span class="marked"><a name="line110"></a>..110 %% @doc open_port({spawn, mochiweb_util:cmd_string(Argv)}, Options).
</span><span class="marked"><a name="line111"></a>..111 cmd_port(Argv, Options) ->
</span><span class="uncovered"><a name="line112"></a>..112     open_port({spawn, cmd_string(Argv)}, Options).
</span><span class="marked"><a name="line113"></a>..113 
</span><span class="marked"><a name="line114"></a>..114 %% @spec cmd([string()]) -> string()
</span><span class="marked"><a name="line115"></a>..115 %% @doc os:cmd(cmd_string(Argv)).
</span><span class="marked"><a name="line116"></a>..116 cmd(Argv) ->
</span><span class="uncovered"><a name="line117"></a>..117     os:cmd(cmd_string(Argv)).
</span><span class="marked"><a name="line118"></a>..118 
</span><span class="marked"><a name="line119"></a>..119 %% @spec cmd_string([string()]) -> string()
</span><span class="marked"><a name="line120"></a>..120 %% @doc Create a shell quoted command string from a list of arguments.
</span><span class="marked"><a name="line121"></a>..121 cmd_string(Argv) ->
</span><span class="uncovered"><a name="line122"></a>..122     join([shell_quote(X) || X <- Argv], " ").
</span><span class="marked"><a name="line123"></a>..123 
</span><span class="marked"><a name="line124"></a>..124 %% @spec join([string()], Separator) -> string()
</span><span class="marked"><a name="line125"></a>..125 %% @doc Join a list of strings together with the given separator
</span><span class="marked"><a name="line126"></a>..126 %%      string or char.
</span><span class="marked"><a name="line127"></a>..127 join([], _Separator) ->
</span><span class="uncovered"><a name="line128"></a>..128     [];
</span><span class="marked"><a name="line129"></a>..129 join([S], _Separator) ->
</span><span class="uncovered"><a name="line130"></a>..130     lists:flatten(S);
</span><span class="marked"><a name="line131"></a>..131 join(Strings, Separator) ->
</span><span class="covered"><a name="line132"></a>..132     lists:flatten(revjoin(lists:reverse(Strings), Separator, [])).
</span><span class="marked"><a name="line133"></a>..133 
</span><span class="marked"><a name="line134"></a>..134 revjoin([], _Separator, Acc) ->
</span><span class="covered"><a name="line135"></a>..135     Acc;
</span><span class="marked"><a name="line136"></a>..136 revjoin([S | Rest], Separator, []) ->
</span><span class="covered"><a name="line137"></a>..137     revjoin(Rest, Separator, [S]);
</span><span class="marked"><a name="line138"></a>..138 revjoin([S | Rest], Separator, Acc) ->
</span><span class="covered"><a name="line139"></a>..139     revjoin(Rest, Separator, [S, Separator | Acc]).
</span><span class="marked"><a name="line140"></a>..140 
</span><span class="marked"><a name="line141"></a>..141 %% @spec quote_plus(atom() | integer() | float() | string() | binary()) -> string()
</span><span class="marked"><a name="line142"></a>..142 %% @doc URL safe encoding of the given term.
</span><span class="marked"><a name="line143"></a>..143 quote_plus(Atom) when is_atom(Atom) ->
</span><span class="uncovered"><a name="line144"></a>..144     quote_plus(atom_to_list(Atom));
</span><span class="marked"><a name="line145"></a>..145 quote_plus(Int) when is_integer(Int) ->
</span><span class="uncovered"><a name="line146"></a>..146     quote_plus(integer_to_list(Int));
</span><span class="marked"><a name="line147"></a>..147 quote_plus(Binary) when is_binary(Binary) ->
</span><span class="uncovered"><a name="line148"></a>..148     quote_plus(binary_to_list(Binary));
</span><span class="marked"><a name="line149"></a>..149 quote_plus(Float) when is_float(Float) ->
</span><span class="uncovered"><a name="line150"></a>..150     quote_plus(mochinum:digits(Float));
</span><span class="marked"><a name="line151"></a>..151 quote_plus(String) ->
</span><span class="uncovered"><a name="line152"></a>..152     quote_plus(String, []).
</span><span class="marked"><a name="line153"></a>..153 
</span><span class="marked"><a name="line154"></a>..154 quote_plus([], Acc) ->
</span><span class="uncovered"><a name="line155"></a>..155     lists:reverse(Acc);
</span><span class="marked"><a name="line156"></a>..156 quote_plus([C | Rest], Acc) when ?QS_SAFE(C) ->
</span><span class="uncovered"><a name="line157"></a>..157     quote_plus(Rest, [C | Acc]);
</span><span class="marked"><a name="line158"></a>..158 quote_plus([$\s | Rest], Acc) ->
</span><span class="uncovered"><a name="line159"></a>..159     quote_plus(Rest, [$+ | Acc]);
</span><span class="marked"><a name="line160"></a>..160 quote_plus([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line161"></a>..161     <<Hi:4, Lo:4>> = <<C>>,
</span><span class="uncovered"><a name="line162"></a>..162     quote_plus(Rest, [hexdigit(Lo), hexdigit(Hi), ?PERCENT | Acc]).
</span><span class="marked"><a name="line163"></a>..163 
</span><span class="marked"><a name="line164"></a>..164 %% @spec urlencode([{Key, Value}]) -> string()
</span><span class="marked"><a name="line165"></a>..165 %% @doc URL encode the property list.
</span><span class="marked"><a name="line166"></a>..166 urlencode(Props) ->
</span><span class="uncovered"><a name="line167"></a>..167     RevPairs = lists:foldl(fun ({K, V}, Acc) ->
</span><span class="uncovered"><a name="line168"></a>..168                                    [[quote_plus(K), $=, quote_plus(V)] | Acc]
</span><span class="marked"><a name="line169"></a>..169                            end, [], Props),
</span><span class="uncovered"><a name="line170"></a>..170     lists:flatten(revjoin(RevPairs, $&, [])).
</span><span class="marked"><a name="line171"></a>..171 
</span><span class="marked"><a name="line172"></a>..172 %% @spec parse_qs(string() | binary()) -> [{Key, Value}]
</span><span class="marked"><a name="line173"></a>..173 %% @doc Parse a query string or application/x-www-form-urlencoded.
</span><span class="marked"><a name="line174"></a>..174 parse_qs(Binary) when is_binary(Binary) ->
</span><span class="uncovered"><a name="line175"></a>..175     parse_qs(binary_to_list(Binary));
</span><span class="marked"><a name="line176"></a>..176 parse_qs(String) ->
</span><span class="uncovered"><a name="line177"></a>..177     parse_qs(String, []).
</span><span class="marked"><a name="line178"></a>..178 
</span><span class="marked"><a name="line179"></a>..179 parse_qs([], Acc) ->
</span><span class="uncovered"><a name="line180"></a>..180     lists:reverse(Acc);
</span><span class="marked"><a name="line181"></a>..181 parse_qs(String, Acc) ->
</span><span class="uncovered"><a name="line182"></a>..182     {Key, Rest} = parse_qs_key(String),
</span><span class="uncovered"><a name="line183"></a>..183     {Value, Rest1} = parse_qs_value(Rest),
</span><span class="uncovered"><a name="line184"></a>..184     parse_qs(Rest1, [{Key, Value} | Acc]).
</span><span class="marked"><a name="line185"></a>..185 
</span><span class="marked"><a name="line186"></a>..186 parse_qs_key(String) ->
</span><span class="uncovered"><a name="line187"></a>..187     parse_qs_key(String, []).
</span><span class="marked"><a name="line188"></a>..188 
</span><span class="marked"><a name="line189"></a>..189 parse_qs_key([], Acc) ->
</span><span class="uncovered"><a name="line190"></a>..190     {qs_revdecode(Acc), ""};
</span><span class="marked"><a name="line191"></a>..191 parse_qs_key([$= | Rest], Acc) ->
</span><span class="uncovered"><a name="line192"></a>..192     {qs_revdecode(Acc), Rest};
</span><span class="marked"><a name="line193"></a>..193 parse_qs_key(Rest=[$; | _], Acc) ->
</span><span class="uncovered"><a name="line194"></a>..194     {qs_revdecode(Acc), Rest};
</span><span class="marked"><a name="line195"></a>..195 parse_qs_key(Rest=[$& | _], Acc) ->
</span><span class="uncovered"><a name="line196"></a>..196     {qs_revdecode(Acc), Rest};
</span><span class="marked"><a name="line197"></a>..197 parse_qs_key([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line198"></a>..198     parse_qs_key(Rest, [C | Acc]).
</span><span class="marked"><a name="line199"></a>..199 
</span><span class="marked"><a name="line200"></a>..200 parse_qs_value(String) ->
</span><span class="uncovered"><a name="line201"></a>..201     parse_qs_value(String, []).
</span><span class="marked"><a name="line202"></a>..202 
</span><span class="marked"><a name="line203"></a>..203 parse_qs_value([], Acc) ->
</span><span class="uncovered"><a name="line204"></a>..204     {qs_revdecode(Acc), ""};
</span><span class="marked"><a name="line205"></a>..205 parse_qs_value([$; | Rest], Acc) ->
</span><span class="uncovered"><a name="line206"></a>..206     {qs_revdecode(Acc), Rest};
</span><span class="marked"><a name="line207"></a>..207 parse_qs_value([$& | Rest], Acc) ->
</span><span class="uncovered"><a name="line208"></a>..208     {qs_revdecode(Acc), Rest};
</span><span class="marked"><a name="line209"></a>..209 parse_qs_value([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line210"></a>..210     parse_qs_value(Rest, [C | Acc]).
</span><span class="marked"><a name="line211"></a>..211 
</span><span class="marked"><a name="line212"></a>..212 %% @spec unquote(string() | binary()) -> string()
</span><span class="marked"><a name="line213"></a>..213 %% @doc Unquote a URL encoded string.
</span><span class="marked"><a name="line214"></a>..214 unquote(Binary) when is_binary(Binary) ->
</span><span class="uncovered"><a name="line215"></a>..215     unquote(binary_to_list(Binary));
</span><span class="marked"><a name="line216"></a>..216 unquote(String) ->
</span><span class="uncovered"><a name="line217"></a>..217     qs_revdecode(lists:reverse(String)).
</span><span class="marked"><a name="line218"></a>..218 
</span><span class="marked"><a name="line219"></a>..219 qs_revdecode(S) ->
</span><span class="uncovered"><a name="line220"></a>..220     qs_revdecode(S, []).
</span><span class="marked"><a name="line221"></a>..221 
</span><span class="marked"><a name="line222"></a>..222 qs_revdecode([], Acc) ->
</span><span class="uncovered"><a name="line223"></a>..223     Acc;
</span><span class="marked"><a name="line224"></a>..224 qs_revdecode([$+ | Rest], Acc) ->
</span><span class="uncovered"><a name="line225"></a>..225     qs_revdecode(Rest, [$\s | Acc]);
</span><span class="marked"><a name="line226"></a>..226 qs_revdecode([Lo, Hi, ?PERCENT | Rest], Acc) when ?IS_HEX(Lo), ?IS_HEX(Hi) ->
</span><span class="uncovered"><a name="line227"></a>..227     qs_revdecode(Rest, [(unhexdigit(Lo) bor (unhexdigit(Hi) bsl 4)) | Acc]);
</span><span class="marked"><a name="line228"></a>..228 qs_revdecode([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line229"></a>..229     qs_revdecode(Rest, [C | Acc]).
</span><span class="marked"><a name="line230"></a>..230 
</span><span class="marked"><a name="line231"></a>..231 %% @spec urlsplit(Url) -> {Scheme, Netloc, Path, Query, Fragment}
</span><span class="marked"><a name="line232"></a>..232 %% @doc Return a 5-tuple, does not expand % escapes. Only supports HTTP style
</span><span class="marked"><a name="line233"></a>..233 %%      URLs.
</span><span class="marked"><a name="line234"></a>..234 urlsplit(Url) ->
</span><span class="uncovered"><a name="line235"></a>..235     {Scheme, Url1} = urlsplit_scheme(Url),
</span><span class="uncovered"><a name="line236"></a>..236     {Netloc, Url2} = urlsplit_netloc(Url1),
</span><span class="uncovered"><a name="line237"></a>..237     {Path, Query, Fragment} = urlsplit_path(Url2),
</span><span class="uncovered"><a name="line238"></a>..238     {Scheme, Netloc, Path, Query, Fragment}.
</span><span class="marked"><a name="line239"></a>..239 
</span><span class="marked"><a name="line240"></a>..240 urlsplit_scheme(Url) ->
</span><span class="uncovered"><a name="line241"></a>..241     urlsplit_scheme(Url, []).
</span><span class="marked"><a name="line242"></a>..242 
</span><span class="marked"><a name="line243"></a>..243 urlsplit_scheme([], Acc) ->
</span><span class="uncovered"><a name="line244"></a>..244     {"", lists:reverse(Acc)};
</span><span class="marked"><a name="line245"></a>..245 urlsplit_scheme(":" ++ Rest, Acc) ->
</span><span class="uncovered"><a name="line246"></a>..246     {string:to_lower(lists:reverse(Acc)), Rest};
</span><span class="marked"><a name="line247"></a>..247 urlsplit_scheme([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line248"></a>..248     urlsplit_scheme(Rest, [C | Acc]).
</span><span class="marked"><a name="line249"></a>..249 
</span><span class="marked"><a name="line250"></a>..250 urlsplit_netloc("//" ++ Rest) ->
</span><span class="uncovered"><a name="line251"></a>..251     urlsplit_netloc(Rest, []);
</span><span class="marked"><a name="line252"></a>..252 urlsplit_netloc(Path) ->
</span><span class="uncovered"><a name="line253"></a>..253     {"", Path}.
</span><span class="marked"><a name="line254"></a>..254 
</span><span class="marked"><a name="line255"></a>..255 urlsplit_netloc(Rest=[C | _], Acc) when C =:= $/; C =:= $?; C =:= $# ->
</span><span class="uncovered"><a name="line256"></a>..256     {lists:reverse(Acc), Rest};
</span><span class="marked"><a name="line257"></a>..257 urlsplit_netloc([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line258"></a>..258     urlsplit_netloc(Rest, [C | Acc]).
</span><span class="marked"><a name="line259"></a>..259 
</span><span class="marked"><a name="line260"></a>..260 
</span><span class="marked"><a name="line261"></a>..261 %% @spec path_split(string()) -> {Part, Rest}
</span><span class="marked"><a name="line262"></a>..262 %% @doc Split a path starting from the left, as in URL traversal.
</span><span class="marked"><a name="line263"></a>..263 %%      path_split("foo/bar") = {"foo", "bar"},
</span><span class="marked"><a name="line264"></a>..264 %%      path_split("/foo/bar") = {"", "foo/bar"}.
</span><span class="marked"><a name="line265"></a>..265 path_split(S) ->
</span><span class="uncovered"><a name="line266"></a>..266     path_split(S, []).
</span><span class="marked"><a name="line267"></a>..267 
</span><span class="marked"><a name="line268"></a>..268 path_split("", Acc) ->
</span><span class="uncovered"><a name="line269"></a>..269     {lists:reverse(Acc), ""};
</span><span class="marked"><a name="line270"></a>..270 path_split("/" ++ Rest, Acc) ->
</span><span class="uncovered"><a name="line271"></a>..271     {lists:reverse(Acc), Rest};
</span><span class="marked"><a name="line272"></a>..272 path_split([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line273"></a>..273     path_split(Rest, [C | Acc]).
</span><span class="marked"><a name="line274"></a>..274 
</span><span class="marked"><a name="line275"></a>..275 
</span><span class="marked"><a name="line276"></a>..276 %% @spec urlunsplit({Scheme, Netloc, Path, Query, Fragment}) -> string()
</span><span class="marked"><a name="line277"></a>..277 %% @doc Assemble a URL from the 5-tuple. Path must be absolute.
</span><span class="marked"><a name="line278"></a>..278 urlunsplit({Scheme, Netloc, Path, Query, Fragment}) ->
</span><span class="uncovered"><a name="line279"></a>..279     lists:flatten([case Scheme of "" -> "";  _ -> [Scheme, "://"] end,
</span><span class="marked"><a name="line280"></a>..280                    Netloc,
</span><span class="marked"><a name="line281"></a>..281                    urlunsplit_path({Path, Query, Fragment})]).
</span><span class="marked"><a name="line282"></a>..282 
</span><span class="marked"><a name="line283"></a>..283 %% @spec urlunsplit_path({Path, Query, Fragment}) -> string()
</span><span class="marked"><a name="line284"></a>..284 %% @doc Assemble a URL path from the 3-tuple.
</span><span class="marked"><a name="line285"></a>..285 urlunsplit_path({Path, Query, Fragment}) ->
</span><span class="uncovered"><a name="line286"></a>..286     lists:flatten([Path,
</span><span class="uncovered"><a name="line287"></a>..287                    case Query of "" -> ""; _ -> [$? | Query] end,
</span><span class="uncovered"><a name="line288"></a>..288                    case Fragment of "" -> ""; _ -> [$# | Fragment] end]).
</span><span class="marked"><a name="line289"></a>..289 
</span><span class="marked"><a name="line290"></a>..290 %% @spec urlsplit_path(Url) -> {Path, Query, Fragment}
</span><span class="marked"><a name="line291"></a>..291 %% @doc Return a 3-tuple, does not expand % escapes. Only supports HTTP style
</span><span class="marked"><a name="line292"></a>..292 %%      paths.
</span><span class="marked"><a name="line293"></a>..293 urlsplit_path(Path) ->
</span><span class="uncovered"><a name="line294"></a>..294     urlsplit_path(Path, []).
</span><span class="marked"><a name="line295"></a>..295 
</span><span class="marked"><a name="line296"></a>..296 urlsplit_path("", Acc) ->
</span><span class="uncovered"><a name="line297"></a>..297     {lists:reverse(Acc), "", ""};
</span><span class="marked"><a name="line298"></a>..298 urlsplit_path("?" ++ Rest, Acc) ->
</span><span class="uncovered"><a name="line299"></a>..299     {Query, Fragment} = urlsplit_query(Rest),
</span><span class="uncovered"><a name="line300"></a>..300     {lists:reverse(Acc), Query, Fragment};
</span><span class="marked"><a name="line301"></a>..301 urlsplit_path("#" ++ Rest, Acc) ->
</span><span class="uncovered"><a name="line302"></a>..302     {lists:reverse(Acc), "", Rest};
</span><span class="marked"><a name="line303"></a>..303 urlsplit_path([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line304"></a>..304     urlsplit_path(Rest, [C | Acc]).
</span><span class="marked"><a name="line305"></a>..305 
</span><span class="marked"><a name="line306"></a>..306 urlsplit_query(Query) ->
</span><span class="uncovered"><a name="line307"></a>..307     urlsplit_query(Query, []).
</span><span class="marked"><a name="line308"></a>..308 
</span><span class="marked"><a name="line309"></a>..309 urlsplit_query("", Acc) ->
</span><span class="uncovered"><a name="line310"></a>..310     {lists:reverse(Acc), ""};
</span><span class="marked"><a name="line311"></a>..311 urlsplit_query("#" ++ Rest, Acc) ->
</span><span class="uncovered"><a name="line312"></a>..312     {lists:reverse(Acc), Rest};
</span><span class="marked"><a name="line313"></a>..313 urlsplit_query([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line314"></a>..314     urlsplit_query(Rest, [C | Acc]).
</span><span class="marked"><a name="line315"></a>..315 
</span><span class="marked"><a name="line316"></a>..316 %% @spec guess_mime(string()) -> string()
</span><span class="marked"><a name="line317"></a>..317 %% @doc  Guess the mime type of a file by the extension of its filename.
</span><span class="marked"><a name="line318"></a>..318 guess_mime(File) ->
</span><span class="uncovered"><a name="line319"></a>..319     case filename:extension(File) of
</span><span class="marked"><a name="line320"></a>..320         ".html" ->
</span><span class="uncovered"><a name="line321"></a>..321             "text/html";
</span><span class="marked"><a name="line322"></a>..322         ".xhtml" ->
</span><span class="uncovered"><a name="line323"></a>..323             "application/xhtml+xml";
</span><span class="marked"><a name="line324"></a>..324         ".xml" ->
</span><span class="uncovered"><a name="line325"></a>..325             "application/xml";
</span><span class="marked"><a name="line326"></a>..326         ".css" ->
</span><span class="uncovered"><a name="line327"></a>..327             "text/css";
</span><span class="marked"><a name="line328"></a>..328         ".js" ->
</span><span class="uncovered"><a name="line329"></a>..329             "application/x-javascript";
</span><span class="marked"><a name="line330"></a>..330         ".jpg" ->
</span><span class="uncovered"><a name="line331"></a>..331             "image/jpeg";
</span><span class="marked"><a name="line332"></a>..332         ".gif" ->
</span><span class="uncovered"><a name="line333"></a>..333             "image/gif";
</span><span class="marked"><a name="line334"></a>..334         ".png" ->
</span><span class="uncovered"><a name="line335"></a>..335             "image/png";
</span><span class="marked"><a name="line336"></a>..336         ".swf" ->
</span><span class="uncovered"><a name="line337"></a>..337             "application/x-shockwave-flash";
</span><span class="marked"><a name="line338"></a>..338         ".zip" ->
</span><span class="uncovered"><a name="line339"></a>..339             "application/zip";
</span><span class="marked"><a name="line340"></a>..340         ".bz2" ->
</span><span class="uncovered"><a name="line341"></a>..341             "application/x-bzip2";
</span><span class="marked"><a name="line342"></a>..342         ".gz" ->
</span><span class="uncovered"><a name="line343"></a>..343             "application/x-gzip";
</span><span class="marked"><a name="line344"></a>..344         ".tar" ->
</span><span class="uncovered"><a name="line345"></a>..345             "application/x-tar";
</span><span class="marked"><a name="line346"></a>..346         ".tgz" ->
</span><span class="uncovered"><a name="line347"></a>..347             "application/x-gzip";
</span><span class="marked"><a name="line348"></a>..348         ".txt" ->
</span><span class="uncovered"><a name="line349"></a>..349             "text/plain";
</span><span class="marked"><a name="line350"></a>..350         ".doc" ->
</span><span class="uncovered"><a name="line351"></a>..351             "application/msword";
</span><span class="marked"><a name="line352"></a>..352         ".pdf" ->
</span><span class="uncovered"><a name="line353"></a>..353             "application/pdf";
</span><span class="marked"><a name="line354"></a>..354         ".xls" ->
</span><span class="uncovered"><a name="line355"></a>..355             "application/vnd.ms-excel";
</span><span class="marked"><a name="line356"></a>..356         ".rtf" ->
</span><span class="uncovered"><a name="line357"></a>..357             "application/rtf";
</span><span class="marked"><a name="line358"></a>..358         ".mov" ->
</span><span class="uncovered"><a name="line359"></a>..359             "video/quicktime";
</span><span class="marked"><a name="line360"></a>..360         ".mp3" ->
</span><span class="uncovered"><a name="line361"></a>..361             "audio/mpeg";
</span><span class="marked"><a name="line362"></a>..362         ".z" ->
</span><span class="uncovered"><a name="line363"></a>..363             "application/x-compress";
</span><span class="marked"><a name="line364"></a>..364         ".wav" ->
</span><span class="uncovered"><a name="line365"></a>..365             "audio/x-wav";
</span><span class="marked"><a name="line366"></a>..366         ".ico" ->
</span><span class="uncovered"><a name="line367"></a>..367             "image/x-icon";
</span><span class="marked"><a name="line368"></a>..368         ".bmp" ->
</span><span class="uncovered"><a name="line369"></a>..369             "image/bmp";
</span><span class="marked"><a name="line370"></a>..370         ".m4a" ->
</span><span class="uncovered"><a name="line371"></a>..371             "audio/mpeg";
</span><span class="marked"><a name="line372"></a>..372         ".m3u" ->
</span><span class="uncovered"><a name="line373"></a>..373             "audio/x-mpegurl";
</span><span class="marked"><a name="line374"></a>..374         ".exe" ->
</span><span class="uncovered"><a name="line375"></a>..375             "application/octet-stream";
</span><span class="marked"><a name="line376"></a>..376         ".csv" ->
</span><span class="uncovered"><a name="line377"></a>..377             "text/csv";
</span><span class="marked"><a name="line378"></a>..378         _ ->
</span><span class="uncovered"><a name="line379"></a>..379             "text/plain"
</span><span class="marked"><a name="line380"></a>..380     end.
</span><span class="marked"><a name="line381"></a>..381 
</span><span class="marked"><a name="line382"></a>..382 %% @spec parse_header(string()) -> {Type, [{K, V}]}
</span><span class="marked"><a name="line383"></a>..383 %% @doc  Parse a Content-Type like header, return the main Content-Type
</span><span class="marked"><a name="line384"></a>..384 %%       and a property list of options.
</span><span class="marked"><a name="line385"></a>..385 parse_header(String) ->
</span><span class="marked"><a name="line386"></a>..386     %% TODO: This is exactly as broken as Python's cgi module.
</span><span class="marked"><a name="line387"></a>..387     %%       Should parse properly like mochiweb_cookies.
</span><span class="uncovered"><a name="line388"></a>..388     [Type | Parts] = [string:strip(S) || S <- string:tokens(String, ";")],
</span><span class="uncovered"><a name="line389"></a>..389     F = fun (S, Acc) ->
</span><span class="uncovered"><a name="line390"></a>..390                 case lists:splitwith(fun (C) -> C =/= $= end, S) of
</span><span class="marked"><a name="line391"></a>..391                     {"", _} ->
</span><span class="marked"><a name="line392"></a>..392                         %% Skip anything with no name
</span><span class="uncovered"><a name="line393"></a>..393                         Acc;
</span><span class="marked"><a name="line394"></a>..394                     {_, ""} ->
</span><span class="marked"><a name="line395"></a>..395                         %% Skip anything with no value
</span><span class="uncovered"><a name="line396"></a>..396                         Acc;
</span><span class="marked"><a name="line397"></a>..397                     {Name, [$\= | Value]} ->
</span><span class="uncovered"><a name="line398"></a>..398                         [{string:to_lower(string:strip(Name)),
</span><span class="marked"><a name="line399"></a>..399                           unquote_header(string:strip(Value))} | Acc]
</span><span class="marked"><a name="line400"></a>..400                 end
</span><span class="marked"><a name="line401"></a>..401         end,
</span><span class="uncovered"><a name="line402"></a>..402     {string:to_lower(Type),
</span><span class="marked"><a name="line403"></a>..403      lists:foldr(F, [], Parts)}.
</span><span class="marked"><a name="line404"></a>..404 
</span><span class="marked"><a name="line405"></a>..405 unquote_header("\"" ++ Rest) ->
</span><span class="uncovered"><a name="line406"></a>..406     unquote_header(Rest, []);
</span><span class="marked"><a name="line407"></a>..407 unquote_header(S) ->
</span><span class="uncovered"><a name="line408"></a>..408     S.
</span><span class="marked"><a name="line409"></a>..409 
</span><span class="marked"><a name="line410"></a>..410 unquote_header("", Acc) ->
</span><span class="uncovered"><a name="line411"></a>..411     lists:reverse(Acc);
</span><span class="marked"><a name="line412"></a>..412 unquote_header("\"", Acc) ->
</span><span class="uncovered"><a name="line413"></a>..413     lists:reverse(Acc);
</span><span class="marked"><a name="line414"></a>..414 unquote_header([$\\, C | Rest], Acc) ->
</span><span class="uncovered"><a name="line415"></a>..415     unquote_header(Rest, [C | Acc]);
</span><span class="marked"><a name="line416"></a>..416 unquote_header([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line417"></a>..417     unquote_header(Rest, [C | Acc]).
</span><span class="marked"><a name="line418"></a>..418 
</span><span class="marked"><a name="line419"></a>..419 %% @spec record_to_proplist(Record, Fields) -> proplist()
</span><span class="marked"><a name="line420"></a>..420 %% @doc calls record_to_proplist/3 with a default TypeKey of '__record'
</span><span class="marked"><a name="line421"></a>..421 record_to_proplist(Record, Fields) ->
</span><span class="uncovered"><a name="line422"></a>..422     record_to_proplist(Record, Fields, '__record').
</span><span class="marked"><a name="line423"></a>..423 
</span><span class="marked"><a name="line424"></a>..424 %% @spec record_to_proplist(Record, Fields, TypeKey) -> proplist()
</span><span class="marked"><a name="line425"></a>..425 %% @doc Return a proplist of the given Record with each field in the 
</span><span class="marked"><a name="line426"></a>..426 %%      Fields list set as a key with the corresponding value in the Record.
</span><span class="marked"><a name="line427"></a>..427 %%      TypeKey is the key that is used to store the record type
</span><span class="marked"><a name="line428"></a>..428 %%      Fields should be obtained by calling record_info(fields, record_type)
</span><span class="marked"><a name="line429"></a>..429 %%      where record_type is the record type of Record
</span><span class="marked"><a name="line430"></a>..430 record_to_proplist(Record, Fields, TypeKey)
</span><span class="marked"><a name="line431"></a>..431   when is_tuple(Record),
</span><span class="marked"><a name="line432"></a>..432        is_list(Fields),
</span><span class="marked"><a name="line433"></a>..433        size(Record) - 1 =:= length(Fields) ->
</span><span class="uncovered"><a name="line434"></a>..434     lists:zip([TypeKey | Fields], tuple_to_list(Record)).
</span><span class="marked"><a name="line435"></a>..435 
</span><span class="marked"><a name="line436"></a>..436 
</span><span class="marked"><a name="line437"></a>..437 shell_quote([], Acc) ->
</span><span class="uncovered"><a name="line438"></a>..438     lists:reverse([$\" | Acc]);
</span><span class="marked"><a name="line439"></a>..439 shell_quote([C | Rest], Acc) when C =:= $\" orelse C =:= $\` orelse
</span><span class="marked"><a name="line440"></a>..440                                   C =:= $\\ orelse C =:= $\$ ->
</span><span class="uncovered"><a name="line441"></a>..441     shell_quote(Rest, [C, $\\ | Acc]);
</span><span class="marked"><a name="line442"></a>..442 shell_quote([C | Rest], Acc) ->
</span><span class="uncovered"><a name="line443"></a>..443     shell_quote(Rest, [C | Acc]).
</span><span class="marked"><a name="line444"></a>..444 
</span><span class="uncovered"><a name="line445"></a>..445 is_atleast_version(Major1) when is_integer(Major1) -> is_atleast_version({Major1, 0, 0});
</span><span class="uncovered"><a name="line446"></a>..446 is_atleast_version({Major1, Minor1}) -> is_atleast_version({Major1, Minor1, 0});
</span><span class="marked"><a name="line447"></a>..447 is_atleast_version({Major1, Minor1, Tiny1}) ->
</span><span class="uncovered"><a name="line448"></a>..448   try
</span><span class="marked"><a name="line449"></a>..449     case regexp:split(erlang:system_info(version), "\\.") of
</span><span class="marked"><a name="line450"></a>..450       {ok, List} when length(List) =:= 3 ->
</span><span class="uncovered"><a name="line451"></a>..451         [Major2, Minor2, Tiny2] = [list_to_integer(X) || X <- List],
</span><span class="marked"><a name="line452"></a>..452         
</span><span class="uncovered"><a name="line453"></a>..453         if
</span><span class="uncovered"><a name="line454"></a>..454           Major2 > Major1 -> true;
</span><span class="marked"><a name="line455"></a>..455           Major2 =:= Major1 ->
</span><span class="uncovered"><a name="line456"></a>..456             if
</span><span class="uncovered"><a name="line457"></a>..457               Minor2 > Minor1 -> true;
</span><span class="marked"><a name="line458"></a>..458               Minor2 =:= Minor1 ->
</span><span class="uncovered"><a name="line459"></a>..459                 if
</span><span class="uncovered"><a name="line460"></a>..460                   Tiny2 >= Tiny1 -> true;
</span><span class="uncovered"><a name="line461"></a>..461                   true -> false
</span><span class="marked"><a name="line462"></a>..462                 end;
</span><span class="uncovered"><a name="line463"></a>..463               true -> false
</span><span class="marked"><a name="line464"></a>..464             end;
</span><span class="uncovered"><a name="line465"></a>..465           true -> false
</span><span class="marked"><a name="line466"></a>..466         end;
</span><span class="uncovered"><a name="line467"></a>..467       _ -> false
</span><span class="marked"><a name="line468"></a>..468     end
</span><span class="marked"><a name="line469"></a>..469   catch
</span><span class="uncovered"><a name="line470"></a>..470     _:_ -> false
</span><span class="marked"><a name="line471"></a>..471   end.
</span><span class="marked"><a name="line472"></a>..472 
</span><span class="marked"><a name="line473"></a>..473 test() ->
</span><span class="uncovered"><a name="line474"></a>..474     test_join(),
</span><span class="uncovered"><a name="line475"></a>..475     test_quote_plus(),
</span><span class="uncovered"><a name="line476"></a>..476     test_unquote(),
</span><span class="uncovered"><a name="line477"></a>..477     test_urlencode(),
</span><span class="uncovered"><a name="line478"></a>..478     test_parse_qs(),
</span><span class="uncovered"><a name="line479"></a>..479     test_urlsplit_path(),
</span><span class="uncovered"><a name="line480"></a>..480     test_urlunsplit_path(),
</span><span class="uncovered"><a name="line481"></a>..481     test_urlsplit(),
</span><span class="uncovered"><a name="line482"></a>..482     test_urlunsplit(),
</span><span class="uncovered"><a name="line483"></a>..483     test_path_split(),
</span><span class="uncovered"><a name="line484"></a>..484     test_guess_mime(),
</span><span class="uncovered"><a name="line485"></a>..485     test_parse_header(),
</span><span class="uncovered"><a name="line486"></a>..486     test_shell_quote(),
</span><span class="uncovered"><a name="line487"></a>..487     test_cmd(),
</span><span class="uncovered"><a name="line488"></a>..488     test_cmd_string(),
</span><span class="uncovered"><a name="line489"></a>..489     test_partition(),
</span><span class="uncovered"><a name="line490"></a>..490     test_safe_relative_path(),
</span><span class="uncovered"><a name="line491"></a>..491     ok.
</span><span class="marked"><a name="line492"></a>..492 
</span><span class="marked"><a name="line493"></a>..493 test_shell_quote() ->
</span><span class="uncovered"><a name="line494"></a>..494     "\"foo \\$bar\\\"\\`' baz\"" = shell_quote("foo $bar\"`' baz"),
</span><span class="uncovered"><a name="line495"></a>..495     ok.
</span><span class="marked"><a name="line496"></a>..496 
</span><span class="marked"><a name="line497"></a>..497 test_cmd() ->
</span><span class="uncovered"><a name="line498"></a>..498     "$bling$ `word`!\n" = cmd(["echo", "$bling$ `word`!"]),
</span><span class="uncovered"><a name="line499"></a>..499     ok.
</span><span class="marked"><a name="line500"></a>..500 
</span><span class="marked"><a name="line501"></a>..501 test_cmd_string() ->
</span><span class="uncovered"><a name="line502"></a>..502     "\"echo\" \"\\$bling\\$ \\`word\\`!\"" = cmd_string(["echo", "$bling$ `word`!"]),
</span><span class="uncovered"><a name="line503"></a>..503     ok.
</span><span class="marked"><a name="line504"></a>..504 
</span><span class="marked"><a name="line505"></a>..505 test_parse_header() ->
</span><span class="uncovered"><a name="line506"></a>..506     {"multipart/form-data", [{"boundary", "AaB03x"}]} =
</span><span class="marked"><a name="line507"></a>..507         parse_header("multipart/form-data; boundary=AaB03x"),
</span><span class="uncovered"><a name="line508"></a>..508     ok.
</span><span class="marked"><a name="line509"></a>..509 
</span><span class="marked"><a name="line510"></a>..510 test_guess_mime() ->
</span><span class="uncovered"><a name="line511"></a>..511     "text/plain" = guess_mime(""),
</span><span class="uncovered"><a name="line512"></a>..512     "text/plain" = guess_mime(".text"),
</span><span class="uncovered"><a name="line513"></a>..513     "application/zip" = guess_mime(".zip"),
</span><span class="uncovered"><a name="line514"></a>..514     "application/zip" = guess_mime("x.zip"),
</span><span class="uncovered"><a name="line515"></a>..515     "text/html" = guess_mime("x.html"),
</span><span class="uncovered"><a name="line516"></a>..516     "application/xhtml+xml" = guess_mime("x.xhtml"),
</span><span class="uncovered"><a name="line517"></a>..517     ok.
</span><span class="marked"><a name="line518"></a>..518 
</span><span class="marked"><a name="line519"></a>..519 test_path_split() ->
</span><span class="uncovered"><a name="line520"></a>..520     {"", "foo/bar"} = path_split("/foo/bar"),
</span><span class="uncovered"><a name="line521"></a>..521     {"foo", "bar"} = path_split("foo/bar"),
</span><span class="uncovered"><a name="line522"></a>..522     {"bar", ""} = path_split("bar"),
</span><span class="uncovered"><a name="line523"></a>..523     ok.
</span><span class="marked"><a name="line524"></a>..524 
</span><span class="marked"><a name="line525"></a>..525 test_urlsplit() ->
</span><span class="uncovered"><a name="line526"></a>..526     {"", "", "/foo", "", "bar?baz"} = urlsplit("/foo#bar?baz"),
</span><span class="uncovered"><a name="line527"></a>..527     {"http", "host:port", "/foo", "", "bar?baz"} =
</span><span class="marked"><a name="line528"></a>..528         urlsplit("http://host:port/foo#bar?baz"),
</span><span class="uncovered"><a name="line529"></a>..529     ok.
</span><span class="marked"><a name="line530"></a>..530 
</span><span class="marked"><a name="line531"></a>..531 test_urlsplit_path() ->
</span><span class="uncovered"><a name="line532"></a>..532     {"/foo/bar", "", ""} = urlsplit_path("/foo/bar"),
</span><span class="uncovered"><a name="line533"></a>..533     {"/foo", "baz", ""} = urlsplit_path("/foo?baz"),
</span><span class="uncovered"><a name="line534"></a>..534     {"/foo", "", "bar?baz"} = urlsplit_path("/foo#bar?baz"),
</span><span class="uncovered"><a name="line535"></a>..535     {"/foo", "", "bar?baz#wibble"} = urlsplit_path("/foo#bar?baz#wibble"),
</span><span class="uncovered"><a name="line536"></a>..536     {"/foo", "bar", "baz"} = urlsplit_path("/foo?bar#baz"),
</span><span class="uncovered"><a name="line537"></a>..537     {"/foo", "bar?baz", "baz"} = urlsplit_path("/foo?bar?baz#baz"),
</span><span class="uncovered"><a name="line538"></a>..538     ok.
</span><span class="marked"><a name="line539"></a>..539 
</span><span class="marked"><a name="line540"></a>..540 test_urlunsplit() ->
</span><span class="uncovered"><a name="line541"></a>..541     "/foo#bar?baz" = urlunsplit({"", "", "/foo", "", "bar?baz"}),
</span><span class="uncovered"><a name="line542"></a>..542     "http://host:port/foo#bar?baz" =
</span><span class="marked"><a name="line543"></a>..543         urlunsplit({"http", "host:port", "/foo", "", "bar?baz"}),
</span><span class="uncovered"><a name="line544"></a>..544     ok.
</span><span class="marked"><a name="line545"></a>..545 
</span><span class="marked"><a name="line546"></a>..546 test_urlunsplit_path() ->
</span><span class="uncovered"><a name="line547"></a>..547     "/foo/bar" = urlunsplit_path({"/foo/bar", "", ""}),
</span><span class="uncovered"><a name="line548"></a>..548     "/foo?baz" = urlunsplit_path({"/foo", "baz", ""}),
</span><span class="uncovered"><a name="line549"></a>..549     "/foo#bar?baz" = urlunsplit_path({"/foo", "", "bar?baz"}),
</span><span class="uncovered"><a name="line550"></a>..550     "/foo#bar?baz#wibble" = urlunsplit_path({"/foo", "", "bar?baz#wibble"}),
</span><span class="uncovered"><a name="line551"></a>..551     "/foo?bar#baz" = urlunsplit_path({"/foo", "bar", "baz"}),
</span><span class="uncovered"><a name="line552"></a>..552     "/foo?bar?baz#baz" = urlunsplit_path({"/foo", "bar?baz", "baz"}),
</span><span class="uncovered"><a name="line553"></a>..553     ok.
</span><span class="marked"><a name="line554"></a>..554 
</span><span class="marked"><a name="line555"></a>..555 test_join() ->
</span><span class="uncovered"><a name="line556"></a>..556     "foo,bar,baz" = join(["foo", "bar", "baz"], $,),
</span><span class="uncovered"><a name="line557"></a>..557     "foo,bar,baz" = join(["foo", "bar", "baz"], ","),
</span><span class="uncovered"><a name="line558"></a>..558     "foo bar" = join([["foo", " bar"]], ","),
</span><span class="uncovered"><a name="line559"></a>..559     "foo bar,baz" = join([["foo", " bar"], "baz"], ","),
</span><span class="uncovered"><a name="line560"></a>..560     "foo" = join(["foo"], ","),
</span><span class="uncovered"><a name="line561"></a>..561     "foobarbaz" = join(["foo", "bar", "baz"], ""),
</span><span class="uncovered"><a name="line562"></a>..562     ok.
</span><span class="marked"><a name="line563"></a>..563 
</span><span class="marked"><a name="line564"></a>..564 test_quote_plus() ->
</span><span class="uncovered"><a name="line565"></a>..565     "foo" = quote_plus(foo),
</span><span class="uncovered"><a name="line566"></a>..566     "1" = quote_plus(1),
</span><span class="uncovered"><a name="line567"></a>..567     "1.1" = quote_plus(1.1),
</span><span class="uncovered"><a name="line568"></a>..568     "foo" = quote_plus("foo"),
</span><span class="uncovered"><a name="line569"></a>..569     "foo+bar" = quote_plus("foo bar"),
</span><span class="uncovered"><a name="line570"></a>..570     "foo%0A" = quote_plus("foo\n"),
</span><span class="uncovered"><a name="line571"></a>..571     "foo%0A" = quote_plus("foo\n"),
</span><span class="uncovered"><a name="line572"></a>..572     "foo%3B%26%3D" = quote_plus("foo;&="),
</span><span class="uncovered"><a name="line573"></a>..573     ok.
</span><span class="marked"><a name="line574"></a>..574 
</span><span class="marked"><a name="line575"></a>..575 test_unquote() ->
</span><span class="uncovered"><a name="line576"></a>..576     "foo bar" = unquote("foo+bar"),
</span><span class="uncovered"><a name="line577"></a>..577     "foo bar" = unquote("foo%20bar"),
</span><span class="uncovered"><a name="line578"></a>..578     "foo\r\n" = unquote("foo%0D%0A"),
</span><span class="uncovered"><a name="line579"></a>..579     ok.
</span><span class="marked"><a name="line580"></a>..580 
</span><span class="marked"><a name="line581"></a>..581 test_urlencode() ->
</span><span class="uncovered"><a name="line582"></a>..582     "foo=bar&baz=wibble+%0D%0A&z=1" = urlencode([{foo, "bar"},
</span><span class="marked"><a name="line583"></a>..583                                                  {"baz", "wibble \r\n"},
</span><span class="marked"><a name="line584"></a>..584                                                  {z, 1}]),
</span><span class="uncovered"><a name="line585"></a>..585     ok.
</span><span class="marked"><a name="line586"></a>..586 
</span><span class="marked"><a name="line587"></a>..587 test_parse_qs() ->
</span><span class="uncovered"><a name="line588"></a>..588     [{"foo", "bar"}, {"baz", "wibble \r\n"}, {"z", "1"}] =
</span><span class="marked"><a name="line589"></a>..589         parse_qs("foo=bar&baz=wibble+%0D%0A&z=1"),
</span><span class="uncovered"><a name="line590"></a>..590     ok.
</span><span class="marked"><a name="line591"></a>..591 
</span><span class="marked"><a name="line592"></a>..592 test_partition() ->
</span><span class="uncovered"><a name="line593"></a>..593     {"foo", "", ""} = partition("foo", "/"),
</span><span class="uncovered"><a name="line594"></a>..594     {"foo", "/", "bar"} = partition("foo/bar", "/"),
</span><span class="uncovered"><a name="line595"></a>..595     {"foo", "/", ""} = partition("foo/", "/"),
</span><span class="uncovered"><a name="line596"></a>..596     {"", "/", "bar"} = partition("/bar", "/"),
</span><span class="uncovered"><a name="line597"></a>..597     {"f", "oo/ba", "r"} = partition("foo/bar", "oo/ba"),
</span><span class="uncovered"><a name="line598"></a>..598     ok.
</span><span class="marked"><a name="line599"></a>..599 
</span><span class="marked"><a name="line600"></a>..600 test_safe_relative_path() ->
</span><span class="uncovered"><a name="line601"></a>..601     "foo" = safe_relative_path("foo"),
</span><span class="uncovered"><a name="line602"></a>..602     "foo/" = safe_relative_path("foo/"),
</span><span class="uncovered"><a name="line603"></a>..603     "foo" = safe_relative_path("foo/bar/.."),
</span><span class="uncovered"><a name="line604"></a>..604     "bar" = safe_relative_path("foo/../bar"),
</span><span class="uncovered"><a name="line605"></a>..605     "bar/" = safe_relative_path("foo/../bar/"),
</span><span class="uncovered"><a name="line606"></a>..606     "" = safe_relative_path("foo/.."),
</span><span class="uncovered"><a name="line607"></a>..607     "" = safe_relative_path("foo/../"),
</span><span class="uncovered"><a name="line608"></a>..608     undefined = safe_relative_path("/foo"),
</span><span class="uncovered"><a name="line609"></a>..609     undefined = safe_relative_path("../foo"),
</span><span class="uncovered"><a name="line610"></a>..610     undefined = safe_relative_path("foo/../.."),
</span><span class="uncovered"><a name="line611"></a>..611     undefined = safe_relative_path("foo//"),
</span><span class="uncovered"><a name="line612"></a>..612     ok.
</span></pre><hr /><p>Generated using <a href='http://github.com/ngerakines/etap'>etap 0.3.3</a>.</p>
          </body>
        </html>
    